name: Frontend Tests + Push

on:
    push:
        branches:
        - master
        paths:
        - consuming-frontend/**
        
jobs:
    ci:
        runs-on: ubuntu-latest
        container:
            image: node 
        
        steps:
            - uses: actions/checkout@v1
            - name: Install And Test
              working-directory: ./consuming-frontend  
              run: |
                npm install
                npm test

    cd: 
        runs-on: ubuntu-latest
        needs: ci
        
        steps:
            - uses: actions/checkout@v1
            - name: Docker login
              run: docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASSWORD }}
            - name: Build
              working-directory: ./consuming-frontend
              run: docker build -t consuming-frontend .  
            - name: Tags  
              run: |
                docker tag consuming-frontend ${{ secrets.DOCKER_USER }}/consuming-frontend:${{ github.sha }}
                docker tag consuming-frontend ${{ secrets.DOCKER_USER }}/consuming-frontend:latest
            - name: Push
              run: |
                docker push ${{ secrets.DOCKER_USER }}/consuming-frontend:${{ github.sha }}
                docker push ${{ secrets.DOCKER_USER }}/consuming-frontend:latest

              